<div class="payment-container">
  <mat-card class="payment-card">
    <mat-card-header>
      <mat-card-title>Pagamento</mat-card-title>
      <mat-card-subtitle>Valor total: R$ {{ courseValue | number:'1.2-2' }}</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Tipo de Pagamento -->
      <div class="payment-type-selector">
        <mat-button-toggle-group [(ngModel)]="selectedPaymentType">
          <mat-button-toggle value="PIX" (click)="onPaymentTypeChange('PIX')">PIX</mat-button-toggle>
          <mat-button-toggle value="BOLETO" (click)="onPaymentTypeChange('BOLETO')">Boleto</mat-button-toggle>
          <mat-button-toggle value="CREDIT_CARD" (click)="onPaymentTypeChange('CREDIT_CARD')">Crédito</mat-button-toggle>
        </mat-button-toggle-group>
      </div>

      <!-- Opções de Pagamento -->
      <div class="payment-options">
        <mat-button-toggle-group>
          <mat-button-toggle [checked]="!isSubscription && !isInstallment" (change)="isSubscription = false; isInstallment = false">
            À Vista
          </mat-button-toggle>
          <mat-button-toggle [checked]="isInstallment" (change)="isInstallment = true; isSubscription = false">
            Parcelado
          </mat-button-toggle>
          <mat-button-toggle [checked]="isSubscription" (change)="isSubscription = true; isInstallment = false">
            Assinatura
          </mat-button-toggle>
        </mat-button-toggle-group>
      </div>

      <!-- Formulário do Cliente -->
      <form [formGroup]="customerForm" class="customer-form">
        <mat-form-field appearance="outline">
          <mat-label>Nome Completo</mat-label>
          <input matInput formControlName="name" required>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <input matInput type="email" formControlName="email" required>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>CPF/CNPJ</mat-label>
          <input matInput formControlName="cpfCnpj" required>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Telefone</mat-label>
          <input matInput formControlName="phone" required>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>CEP</mat-label>
          <input matInput formControlName="postalCode" required>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Número</mat-label>
          <input matInput formControlName="addressNumber" required>
        </mat-form-field>
      </form>

      <!-- Opções de Parcelamento -->
      <div *ngIf="isInstallment" class="installment-form" [formGroup]="installmentForm">
        <mat-form-field appearance="outline">
          <mat-label>Número de Parcelas</mat-label>
          <mat-select formControlName="installmentCount">
            <mat-option *ngFor="let option of installmentOptions" [value]="option.value">
              {{ option.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Data do Primeiro Vencimento</mat-label>
          <input matInput type="date" formControlName="dueDate">
        </mat-form-field>
      </div>

      <!-- Opções de Assinatura -->
      <div *ngIf="isSubscription" class="subscription-options">
        <mat-form-field appearance="outline">
          <mat-label>Ciclo de Pagamento</mat-label>
          <mat-select [(ngModel)]="selectedCycle" (selectionChange)="onCycleChange($event.value)">
            <mat-option *ngFor="let option of availableSubscriptionOptions" 
                        [value]="option.cycle"
                        [disabled]="option.disabled">
              {{ option.label }} - R$ {{ option.value | number:'1.2-2' }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- QR Code do PIX -->
      <div *ngIf="pixQRCode" class="pix-qrcode">
        <img [src]="pixQRCode" alt="QR Code PIX">
      </div>
    </mat-card-content>

    <mat-card-actions>
      <button mat-raised-button color="primary" 
              (click)="processPayment(isSubscription)"
              [disabled]="!isFormValid()">
        Finalizar Pagamento
      </button>
    </mat-card-actions>
  </mat-card>
</div>
